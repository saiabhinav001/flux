name: Flux Scheduler

on:
  schedule:
    - cron: '*/5 * * * *' # Every 5 minutes (GitHub Min)
  workflow_dispatch: # Manual trigger button

jobs:
  cron:
    runs-on: ubuntu-latest
    steps:
      - name: Check Secrets & Run Cron
        env:
          DEPLOY_URL: ${{ secrets.DEPLOY_URL }}
          CRON_KEY: ${{ secrets.CRON_KEY }}
        run: |
          if [ -z "$DEPLOY_URL" ]; then
            echo "Error: DEPLOY_URL secret is not set!"
            echo "Please go to Settings > Secrets and variables > Actions and add 'DEPLOY_URL'."
            exit 1
          fi
          
          echo "Triggering Cron Job at: $DEPLOY_URL/api/cron"
          curl -f -L "$DEPLOY_URL/api/cron?key=$CRON_KEY"
